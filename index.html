<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>Multi-AI Chatroom</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }

    #messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      background: #222;
    }

    .message {
      margin-bottom: 8px;
      white-space: pre-wrap;
    }

    .user-message {
      color: #2196f3;
    }

    .ai-message {
      color: #4caf50;
    }

    #input-area {
      display: flex;
      padding: 8px;
      background: #111;
      border-top: 1px solid #333;
    }

    #input-message {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      background: #444;
      color: #eee;
      border: none;
      border-radius: 4px;
      margin-right: 8px;
    }

    #send-btn {
      padding: 10px 16px;
      font-size: 16px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #send-btn:hover {
      background: #45a049;
    }
  </style>
</head>
<body>

<div id="messages"></div>

<div id="input-area">
  <input id="input-message" type="text" placeholder="Say something..." />
  <button id="send-btn">Send</button>
</div>

<script>
  const messages = [];
  const bots = ["ChatGPT", "Claude", "Gemini"];

  function addMessage(msg, isUser, sender = "") {
    const messagesDiv = document.getElementById("messages");
    const messageDiv = document.createElement("div");
    messageDiv.classList.add("message");
    if (isUser) {
      messageDiv.classList.add("user-message");
      messageDiv.textContent = `You: ${msg}`;
    } else {
      messageDiv.classList.add("ai-message");
      messageDiv.textContent = `${sender}: ${msg}`;
    }
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  function sendMessage() {
    const input = document.getElementById("input-message");
    const message = input.value.trim();
    if (!message) return;

    addMessage(message, true);
    messages.push({ role: "user", content: message });
    input.value = "";

    bots.forEach(bot => maybeRespond(bot));
  }

  function hasTyping() {
    return messages.slice(-3).some(m => m.content === "Typing...");
  }

  function maybeRespond(botName) {
    if (hasTyping()) return;

    addMessage("Typing...", false, botName);
    messages.push({ role: "assistant", content: "Typing..." });

    const botSystemMessage = {
      "ChatGPT": "You are ChatGPT. You are in a group chat with Claude and Gemini. Chat with them.",
      "Claude": "You are Claude. You are in a group chat with ChatGPT and Gemini. Chat with them.",
      "Gemini": "You are Gemini. You are in a group chat with Claude and ChatGPT. Chat with them."
    };

    const fullPrompt = [
      { role: "system", content: botSystemMessage[botName] },
      ...messages.filter(m => m.content !== "Typing...")
    ];

    const model = {
      ChatGPT: "gpt-4o",
      Claude: "claude-sonnet-4",
      Gemini: "google/gemini-2.0-flash-lite-001"
    }[botName];

    puter.ai.chat(fullPrompt, { model }).then(response => {
      const content = response?.message?.content || response?.message?.content?.[0]?.text || "[No response]";
      removeLastTyping();
      addMessage(content, false, botName);
      messages.push({ role: "assistant", content });
    }).catch(error => {
      removeLastTyping();
      const errText = `[Error: ${JSON.stringify(error)}]`;
      addMessage(errText, false, botName);
      messages.push({ role: "assistant", content: errText });
    });
  }

  function removeLastTyping() {
    for (let i = messages.length - 1; i >= 0; i--) {
      if (messages[i].content === "Typing...") {
        messages.splice(i, 1);
        const messagesDiv = document.getElementById("messages");
        messagesDiv.removeChild(messagesDiv.children[i]);
        break;
      }
    }
  }

  document.getElementById("send-btn").onclick = sendMessage;
  document.getElementById("input-message").addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });

  // Initial intro messages to kick things off
  bots.forEach(bot => {
    const intro = {
      ChatGPT: "You are ChatGPT. You are in a group chat with Claude and Gemini. Chat with them.",
      Claude: "You are Claude. You are in a group chat with ChatGPT and Gemini. Chat with them.",
      Gemini: "You are Gemini. You are in a group chat with Claude and ChatGPT. Chat with them."
    }[bot];
    messages.push({ role: "user", content: intro });
    maybeRespond(bot);
  });
</script>

</body>
</html>
